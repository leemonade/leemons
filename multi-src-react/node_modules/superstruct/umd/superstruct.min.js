!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self).Superstruct={})}(this,(function(t){"use strict";function r(t,r,n){return r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}function n(t,r){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(t);r&&(e=e.filter((function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable}))),n.push.apply(n,e)}return n}function e(t){for(var e=1;e<arguments.length;e++){var u=null!=arguments[e]?arguments[e]:{};e%2?n(Object(u),!0).forEach((function(n){r(t,n,u[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(u)):n(Object(u)).forEach((function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(u,r))}))}return t}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,r){return(o=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}function a(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function i(t,r,n){return(i=a()?Reflect.construct:function(t,r,n){var e=[null];e.push.apply(e,r);var u=new(Function.bind.apply(t,e));return n&&o(u,n.prototype),u}).apply(null,arguments)}function c(t){var r="function"==typeof Map?new Map:void 0;return(c=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return i(t,arguments,u(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o(e,t)})(t)}function f(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function l(t,r){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,r){if(t){if("string"==typeof t)return f(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}var p=Object.prototype.toString,s=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var r=typeof t;if("boolean"===r)return"boolean";if("string"===r)return"string";if("number"===r)return"number";if("symbol"===r)return"symbol";if("function"===r)return"GeneratorFunction"===y(t)?"generatorfunction":"function";if(function(t){return Array.isArray?Array.isArray(t):t instanceof Array}(t))return"array";if(function(t){if(t.constructor&&"function"==typeof t.constructor.isBuffer)return t.constructor.isBuffer(t);return!1}(t))return"buffer";if(function(t){try{if("number"==typeof t.length&&"function"==typeof t.callee)return!0}catch(t){if(-1!==t.message.indexOf("callee"))return!0}return!1}(t))return"arguments";if(function(t){return t instanceof Date||"function"==typeof t.toDateString&&"function"==typeof t.getDate&&"function"==typeof t.setDate}(t))return"date";if(function(t){return t instanceof Error||"string"==typeof t.message&&t.constructor&&"number"==typeof t.constructor.stackTraceLimit}(t))return"error";if(function(t){return t instanceof RegExp||"string"==typeof t.flags&&"boolean"==typeof t.ignoreCase&&"boolean"==typeof t.multiline&&"boolean"==typeof t.global}(t))return"regexp";switch(y(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(t){return"function"==typeof t.throw&&"function"==typeof t.return&&"function"==typeof t.next}(t))return"generator";switch(r=p.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return r.slice(8,-1).toLowerCase().replace(/\s/g,"")};function y(t){return"function"==typeof t.constructor?t.constructor.name:null}var v={any:function(t){return void 0!==t},arguments:function(t){return"arguments"===s(t)},array:function(t){return"array"===s(t)},boolean:function(t){return"boolean"===s(t)},buffer:function(t){return"buffer"===s(t)},date:function(t){return"date"===s(t)&&!isNaN(t)},error:function(t){return"error"===s(t)},float32array:function(t){return"float32array"===s(t)},float64array:function(t){return"float64array"===s(t)},function:function(t){return"function"===s(t)},generatorfunction:function(t){return"generatorfunction"===s(t)},int16array:function(t){return"int16array"===s(t)},int32array:function(t){return"int32array"===s(t)},int8array:function(t){return"int8array"===s(t)},map:function(t){return"map"===s(t)},null:function(t){return"null"===s(t)},number:function(t){return"number"===s(t)},object:function(t){return"object"===s(t)},promise:function(t){return"promise"===s(t)},regexp:function(t){return"regexp"===s(t)},set:function(t){return"set"===s(t)},string:function(t){return"string"===s(t)},symbol:function(t){return"symbol"===s(t)},uint16array:function(t){return"uint16array"===s(t)},uint32array:function(t){return"uint32array"===s(t)},uint8array:function(t){return"uint8array"===s(t)},uint8clampedarray:function(t){return"uint8clampedarray"===s(t)},undefined:function(t){return"undefined"===s(t)},weakmap:function(t){return"weakmap"===s(t)},weakset:function(t){return"weakset"===s(t)}};function d(t,r){if(!t)throw new Error("Invariant failed")}var h=function(t){var r,n;function e(r){var n;r.length>0||d(!1);var u=r[0],o=u.path,a=u.value,i=u.type,c=u.branch,f=function(t,r){if(null==t)return{};var n,e,u={},o=Object.keys(t);for(e=0;e<o.length;e++)n=o[e],r.indexOf(n)>=0||(u[n]=t[n]);return u}(u,["path","value","type","branch"]),l="Expected a value of type `"+i+"`"+(o.length?" for `"+o.join(".")+"`":"")+" but received `"+JSON.stringify(a)+"`.";return(n=t.call(this,l)||this).type=i,n.value=a,Object.assign(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n),f),n.path=o,n.branch=c,n.failures=r,n.stack=(new Error).stack,n.__proto__=e.prototype,n}return n=t,(r=e).prototype=Object.create(n.prototype),r.prototype.constructor=r,r.__proto__=n,e}(c(TypeError)),b=Symbol("STRUCT"),g=function(t){return"function"==typeof t&&t[b]},m=function(t){var r=t.struct.Error,n=function t(r){return t.assert(r)};return Object.defineProperty(n,b,{value:!0}),n.kind=t.kind,n.type=t.type,n.default=function(){return"function"==typeof t.defaults?t.defaults():t.defaults},n.test=function(t){return!n.check(t,[t],[])[0]},n.assert=function(t){var e=n.check(t,[t],[]),u=e[0],o=e[1];if(u)throw new r(u);return o},n.validate=function(t){var e=n.check(t,[t],[]),u=e[0],o=e[1];return u?[new r(u)]:[void 0,o]},n.check=function(t,r,e){return void 0===t&&(t=n.default()),[[n.fail({value:t,branch:r,path:e})]]},n.fail=function(t){return e(e({},t),{},{type:"type"in t?t.type:n.type})},n},k=function(t,r,n){Array.isArray(t)&&0!==t.length||d(!1);var e=t.map((function(t){return n(t)})),u=e.map((function(t){return t.type})).join(" | "),o=m({kind:"union",type:u,defaults:r,struct:n});return o.check=function(t,r,n){void 0===t&&(t=o.default());for(var u,a=l(e);!(u=a()).done;){var i=u.value.check(t,r,n),c=i[0],f=i[1];if(!c)return[void 0,f]}return[[o.fail({value:t,branch:r,path:n})]]},o},j=function(t){void 0===t&&(t={});var r=function t(r,n){return function(t,r,n){if(g(t))return t;if(Array.isArray(t)){if(1===t.length){var e=t[0];return n.array([e],r)}if(t.length>1)return n.tuple(t,r)}if("function"==typeof t)return n.function(t,r);if("object"==typeof t)return n.object(t,r);if("string"==typeof t){var u,o=!1;if(t.endsWith("?")&&(o=!0,t=t.slice(0,-1)),t.includes("|")){var a=t.split(/\s*\|\s*/g);u=n.union(a,r)}else if(t.includes("&")){var i=t.split(/\s*&\s*/g);u=n.intersection(i,r)}else u=n.scalar(t,r);return o&&(u=n.union([u,"undefined"],void 0)),u}throw new Error("A schema definition must be an object, array, string or function, but you passed: "+t)}(r,n,t)};return r.array=function(t,n){return function(t,r,n){Array.isArray(t)&&1===t.length||d(!1);var e=n(t[0],void 0),u=m({kind:"array",type:e.type+"[]",defaults:r,struct:n});return u.check=function(t,r,n){if(void 0===t&&(t=u.default()),!Array.isArray(t))return[[u.fail({value:t,branch:r,path:n})]];for(var o=[],a=[],i=0;i<t.length;i++){var c=t[i],f=e.check(c,r.concat(c),n.concat(i)),l=f[0],p=f[1];l?a.push.apply(a,l):o[i]=p}return a.length?[a]:[void 0,o]},u}(t,n,r)},r.dynamic=function(t,n){return function(t,r,n){"function"!=typeof t&&d(!1);var e=m({kind:"dynamic",type:"dynamic<…>",defaults:r,struct:n});return e.check=function(r,n,u){return void 0===r&&(r=e.default()),t(r,n,u).check(r,n,u)},e}(t,n,r)},r.enum=function(t,n){return function(t,r,n){Array.isArray(t)||d(!1);var e=n((function(r){return t.includes(r)}),r);return e.kind="enum",e.type=t.map((function(t){return"string"==typeof t?'"'+t+'"':""+t})).join(" | "),e}(t,n,r)},r.function=function(t,n){return function(t,r,n){var u=m({kind:"function",type:"function<…>",defaults:r,struct:n});return u.check=function(r,n,o){void 0===r&&(r=u.default());var a=t(r,n,o);if(!0===a)return[void 0,r];var i=[];if(!1===a)i.push(u.fail({value:r,branch:n,path:o}));else if(Array.isArray(a)&&a.length>0)for(var c,f=l(a);!(c=f()).done;){var p=c.value;i.push(u.fail(e({value:r,branch:n,path:o},p)))}else"object"==typeof a?i.push(u.fail(e({value:r,branch:n,path:o},a))):d(!1);return[i]},u}(t,n,r)},r.instance=function(t,n){return function(t,r,n){"function"!=typeof t&&d(!1);var e=n((function(r){return r instanceof t}),r);return e.kind="instance",e.type="instance<"+t.name+">",e}(t,n,r)},r.interface=function(t,n){return function(t,r,n){"object"!=typeof t&&d(!1);var e={};for(var u in t)e[u]=n(t[u]);var o=m({kind:"interface",type:"interface<{"+Object.keys(t).join()+"}>",defaults:r,struct:n});return o.check=function(t,r,n){if(void 0===t&&(t=o.default()),"object"!=typeof t&&"function"!=typeof t)return[[o.fail({value:t,branch:r,path:n})]];var u=[];for(var a in e){var i=e[a],c=t[a],f=i.check(c,r.concat(c),n.concat(a))[0];f&&u.push.apply(u,f)}return u.length?[u]:[void 0,t]},o}(t,n,r)},r.intersection=function(t,n){return function(t,r,n){Array.isArray(t)&&0!==t.length||d(!1);var e=t.map((function(t){return n(t)})),u=e.map((function(t){return t.type})).join(" & "),o=m({kind:"intersection",type:u,defaults:r,struct:n});return o.check=function(t,r,n){void 0===t&&(t=o.default());for(var u,a=t,i=l(e);!(u=i()).done;){var c=u.value.check(t,r,n),f=c[0],p=c[1];if(f)return[[o.fail({value:t,branch:r,path:n})]];a=p}return[void 0,a]},o}(t,n,r)},r.lazy=function(t,n){return function(t,r,n){"function"!=typeof t&&d(!1);var e=m({kind:"lazy",type:"lazy<…>",defaults:r,struct:n});return e.check=function(){return Object.assign(e,t()),e.check.apply(e,arguments)},e}(t,n,r)},r.literal=function(t,n){return function(t,r,n){var e=n((function(r){return r===t}),r);return e.kind="literal",e.type="string"==typeof t?'"'+t+'"':""+t,e}(t,n,r)},r.object=function(t,n){return function(t,r,n){"object"!=typeof t&&d(!1);var e={};for(var u in t)e[u]=n(t[u]);var o=m({kind:"object",type:"{"+Object.keys(t).join()+"}",defaults:r,struct:n});return o.check=function(t,r,n){void 0===t&&(t=o.default());var u=o.default();if(void 0===t&&(t=u),"object"!==s(t))return[[o.fail({value:t,branch:r,path:n})]];for(var a,i={},c=[],f=l(new Set(Object.keys(e).concat(Object.keys(t))));!(a=f()).done;){var p=a.value,y=t[p],v=n.concat(p),d=r.concat(y),h=e[p];if(void 0===y&&null!=u&&p in u&&(y="function"==typeof u[p]?u[p](t,r,n):u[p]),p in e){var b=h.check(y,d,v),g=b[0],m=b[1];g?c.push.apply(c,g):void 0!==m&&p in e&&(i[p]=m)}else c.push(o.fail({type:void 0,value:y,path:v,branch:t}))}return c.length?[c]:[void 0,i]},o}(t,n,r)},r.optional=function(t,n){return k([t,"undefined"],n,r)},r.partial=function(t,n){return function(t,r,n){"object"!=typeof t&&d(!1);var e={};for(var u in t)e[u]=n.union([t[u],"undefined"]);var o=m({kind:"object",type:"{"+Object.keys(t).join()+"}",defaults:r,struct:n});return o.check=function(t,r,n){void 0===t&&(t=o.default());var u=o.default();if(void 0===t&&(t=u),"object"!==s(t))return[[o.fail({value:t,branch:r,path:n})]];for(var a,i={},c=[],f=l(t);!(a=f()).done;){var p=a.value,y=t[p],v=n.concat(p),d=r.concat(y),h=e[p];if(void 0===y&&null!=u&&p in u&&(y="function"==typeof u[p]?u[p](t,r,n):u[p]),p in e){var b=h.check(y,d,v),g=b[0],m=b[1];g?c.push.apply(c,g):void 0!==m&&p in e&&(i[p]=m)}else c.push(o.fail({type:void 0,value:y,path:v,branch:t}))}return c.length?[c]:[void 0,i]},o}(t,n,r)},r.pick=function(t,n){return function(t,r,n){"object"!=typeof t&&d(!1);var e={};for(var u in t)e[u]=n(t[u]);var o=m({kind:"pick",type:"pick<{"+Object.keys(t).join()+"}>",defaults:r,struct:n});return o.check=function(t,r,n){void 0===t&&(t=o.default());var u=o.default();if(void 0===t&&(t=u),"object"!==s(t))return[[o.fail({value:t,branch:r,path:n})]];var a={},i=[];for(var c in e){var f=t[c],l=n.concat(c),p=r.concat(f),y=e[c];void 0===f&&null!=u&&c in u&&(f="function"==typeof u[c]?u[c](t,r,n):u[c]);var v=y.check(f,p,l),d=v[0],h=v[1];d?i.push.apply(i,d):void 0!==h&&c in e&&(a[c]=h)}return i.length?[i]:[void 0,a]},o}(t,n,r)},r.record=function(t,n){return function(t,r,n){Array.isArray(t)&&2===t.length||d(!1);var u=n(t[0]),o=n(t[1]),a=m({kind:"record",type:"record<"+u.type+","+o.type+">",defaults:r,struct:n});return a.check=function(t,r,n){var i=a.default();if(t=i?e(e({},i),t):t,"object"!==s(t))return[[a.fail({value:t,branch:r,path:n})]];var c={},f=[];for(var l in t){var p=t[l],y=n.concat(l),v=r.concat(p),d=u.check(l,v,y),h=d[0],b=d[1];if(h)f.push.apply(f,h);else{var g=o.check(p,v,y),m=g[0],k=g[1];m?f.push.apply(f,m):c[b]=k}}return f.length?[f]:[void 0,c]},a}(t,n,r)},r.scalar=function(t,n){return function(t,r,n){"string"!=typeof t&&d(!1);var e=n.Types;t in e||d(!1);var u=n(e[t],r);return u.kind="scalar",u.type=t,u}(t,n,r)},r.size=function(t,n){return function(t,r,n){Array.isArray(t)&&2===t.length&&t.every((function(t){return"number"==typeof t}))||d(!1);var e=t[0],u=t[1],o=n((function(t){return null!=t&&"number"==typeof t.length&&t.length>=e&&t.length<=u}),r);return o.kind="size",o.type="size<"+e+","+u+">",o}(t,n,r)},r.tuple=function(t,n){return function(t,r,n){Array.isArray(t)||d(!1);var e=t.map((function(t){return n(t)})),u=m({kind:"tuple",type:"["+e.map((function(t){return t.type})).join()+"]",defaults:r,struct:n});return u.check=function(t,r,n){if(void 0===t&&(t=u.default()),!Array.isArray(t))return[[u.fail({value:t,branch:r,path:n})]];for(var o=[],a=[],i=Math.max(t.length,e.length),c=0;c<i;c++){var f=e[c],l=t[c],p=n.concat(c),s=r.concat(l);if(f){var y=f.check(l,s,p),v=y[0],d=y[1];v?a.push.apply(a,v):o[c]=d}else a.push(u.fail({type:void 0,value:l,path:p,branch:s}))}return a.length?[a]:[void 0,o]},u}(t,n,r)},r.union=function(t,n){return k(t,n,r)},r.Error=t.error||h,r.Types=e(e({},v),t.types),r},O=j();t.StructError=h,t.Types=v,t.isStruct=g,t.struct=O,t.superstruct=j,Object.defineProperty(t,"__esModule",{value:!0})}));
